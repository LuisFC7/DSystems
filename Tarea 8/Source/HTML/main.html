<!DOCTYPE html>
<html lang="en">
    <script src="/WSClient.js"></script>
    <!-- IMPLEMENTACIÓN DE SCRIPTS -->
    <script>
      var Fotografia=null;

        //<!-- FUNCION PARA ABRIR VENTANA DE DESCRIPCION DE ARTICULO -->
        function ventanaDescripcion()
        {
            // Obtener referencia a los elementos del DOM
            const botonDescripcion = document.getElementById('Boton_descripcion');
            const descripcionInput = document.getElementById('Consulta_Descripcion');
        
            // Agregar evento click al botón de Ver descripción
            botonDescripcion.addEventListener('click', () => {
              // Obtener la descripción del artículo
              const descripcion = descripcionInput.value;
        
              // Crear la ventana emergente
              const ventanaEmergente = window.open('', 'Descripción del artículo', 'width=400,height=300');
        
              // Abrir un nuevo documento en la ventana emergente
              ventanaEmergente.document.open();
        
              // Agregar el contenido HTML a la ventana emergente
              ventanaEmergente.document.write(`
                //<h1>Descripción del artículo</h1>
                <h1 style="font-family:'Staatliches', cursive; text-transform:uppercase;">Descripción del artículo</h1>

                <p>${descripcion}</p>
                <button onclick="window.close()">Cerrar</button>
              `);
        
              // Cerrar la escritura en el documento de la ventana emergente
              ventanaEmergente.document.close();
            });
          }
        
          // Llamar a la función para habilitar la funcionalidad
          //<!-- abrirVentanaDescripcion(); -->

         // <!-- FUNCION PARA DESPLEGAR PANTALLA DE CARRITO DE COMPRAS -->
          function mostrarCarrito() {

            const btnCarrito = document.getElementById('Btn-carrito');
            const compraArticulos = document.getElementById('Compra_articulos');
            const articulosCarrito = document.getElementById('Articulos_carrito');
            const btnCerrar = document.getElementById('Btn_cerrar');
        
            btnCarrito.addEventListener('click', () => {
              compraArticulos.style.display = 'none';
              articulosCarrito.style.display = 'block';
            });
        
            btnCerrar.addEventListener('click', () => {
              articulosCarrito.style.display = 'none';
              compraArticulos.style.display = 'block';
            });
          }

          function mostrarOcultar(divMostrar,divOcultar){
            const divM = document.getElementById(divMostrar);
            const divO = document.getElementById(divOcultar);
            if (divM) {
              divM.style.display = 'block';
            }
            if (divO) {
              divO.style.display = 'none';
            }
          }

       //   <!-- FUNCIONES PARA PRODUCIR JSON -->

         // <!-- FUNCION PARA LEER FOTOGRAFIA -->
          function readSingleFile(files,imagen)
          {
            var file = files[0];
            if (!file) return;
            var reader = new FileReader();
            reader.onload = function(e)
            {
            imagen.src = reader.result;
            // reader.result incluye al principio: "data:image/jpeg;base64,"
            Fotografia = reader.result.split(',')[1];
            };
            reader.readAsDataURL(file);
          }

//<!-- ALTA DE UN ARTICULO -->
          function capturaArticulo(){
            var URL = "/Servicio/rest/ws";
            var cliente = new WSClient(URL);
            // var fotografia = null;

            //Aqui ingresar todos los campos para el alta de un producto.
            var producto={
                Nombre: document.getElementById("Captura_nombre").value,
                Descripcion: document.getElementById("Captura_descripcion").value,
                Precio: document.getElementById("Captura_precio").value,
                Cantidad: document.getElementById("Captura_cantidad").value,
                Fotografia: Fotografia
            };

            cliente.postJson("Captura_usuario",
            {
                producto: producto
            },
            function(code,result)
            {
                if(code==200)
                    alert("Producto agregado correctamente :)");
                else
                    alert(JSON.stringify(result));
            });
          }

         // <!-- FUNCION PARA REALIZAR LA PRIMERA CONSULTA EN LA BUSQUEDA -->
          function comprarProducto(){
            var URL = "/Servicio/rest/ws";
            var cliente = new WSClient(URL);
            // var fotografia = null;
        
            cliente.postJson("Compra_articulos",
            {
                Nombre:document.getElementById("Consulta_nombre").value,
                Descripcion:document.getElementById("Consulta_descripcion").value
            },
        
            function(code,result)
            {
                //Primero se comprueba que exista el produeto
                if(code==200){
                    Fotografia=result.Fotografia;
                    document.getElementById("Consulta_fotografia").src=Fotografia != null ? "data:image/jpeg; base64,"+Fotografia: "/usuario_sin_foto.pbg";
                    document.getElementById("Consulta_nombre").value=result.Nombre;
                    document.getElementById("Consulta_precio").value=result.Descripcion;
                    // document.getElementById("Producto_precio").value=result.Precio;
                    // document.getElementById("Producto_cantidad").value=result.Cantidad;
                   
                }else{
                    alert("El producto buscado no se encuentra disponible"+JSON.stringify(result));
                    
                }
            });
          }

        //<!-- ESTA CONSULTA SOLO SE HACER PARA LA VENTANA DEL CARRITO DE COMPRAS -->
        function descripcionCarrito(){
          var cliente = new WSCliente(URL)
          var producto={
            Descripcion:document.getElementById("ConsultaDescripcion").value
          }
        }

        function actualizarCarrito(){
          var cliente = new  WSClient(URL);
          var producto={
            Nombre: document.getElementById("Captura_nombre").value,
            Descripcion: document.getElementById("Captura_descripcion").value,
            Precio: document.getElementById("Captura_precio").value,
            Cantidad: document.getElementById("Captura_cantidad").value,
            Fotografia: Fotografia
          };

        }
      
    </script>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarea 7</title>
</head>
<body>
  <div id="Principal" style="display: block;">
    <div class="titulo">
      <h1>Articulos.</h1>
    </div>
    <!-- MENU PRINCIPAL -->
    <div class="menuPrincipal">
        <button onclick="mostrarOcultar('Captura_articulos','Principal')">Captura artículo</button>
        <button onclick="mostrarOcultar('Compra_articulos','Principal')">Compra de artículos</button>
    </div>
  </div>

    <!-- PANTALLA CAPTURA DE ARTICULOS -->
      <div id="Captura_articulos" style="display:none">
        <h1>Captura de artículos</h1>
        <input type="text" id="Captura_nombre" placeholder="Nombre">
        <textarea id="Captura_descripcion" placeholder="Descripción"></textarea>
        <input type="text" id="Captura_precio" placeholder="Precio">
        <input type="text" id="Captura_cantidad" placeholder="Cantidad">
        <input type="file" id="Captura_fotografia">
        <button onclick="mostrarOcultar('Principal','Captura_articulos')">Regresar a principal</button>
      </div>
      
      <!-- PANTALLAS COMPRA DE ARTICULOS -->
      <div id="Compra_articulos" style="display: none;">
        <h1>Compra de artículos</h1>
        <div id="Campos_articulos">
          <input type="search" id="Consulta_nombre" placeholder="Buscar por Nombre">
          <input type="search" id="Consulta_descripcion" placeholder="Buscar por Descripción">
          <button id="Buscar_articulo" onclick="mostrarOcultar('Ver_articulo','')">Buscar artículo</button>
          
          <button onclick="mostrarOcultar('Principal','Compra_articulos')">Regresar a principal</button>
        </div>

        <div id="Btn-carrito">
            <button onclick="mostrarOcultar('Articulos_carrito','Compra_articulos')">Carrito</button>
        </div>

    </div>

  <!-- VISUALIZACIÓN DEL CARRITO DE COMPRAS. -->

    <div id="Articulos_carrito" style="display:none;">
      <h1>Artículos en el carrito</h1>
      <input type="image" id="Consulta_fotografia">
      <input type="text" id="Consulta_nombre" readonly>
      <input type="number" id="Consulta_cantidad" readonly>
      <input type="text" id="Consulta_precio" readonly>
      <input type="text" id="Costo" readonly>
      <input type="text" id="Total_compra" readonly>
      <button>Eliminar</button>
      <button id="Btn_cerrar" onclick="mostrarOcultar('Compra_articulos','Articulos_carrito')">Cerrar</button>
    </div>

  <!-- VISUALIZACIÓN DEL ARTICULO BUSCADO-->
    <div id="Ver_articulo" style="display:none;">
      <h1>Articulos encontrados.</h1>
      <img src="" id="Consulta_fotografia">
      <input type="text" id="Consulta_nombre" readonly>
      <input type="text" id="Consulta_precio" readonly>
      <input type="number" id="Consulta_cantidad" value="1">
      <button id="Boton_compra">Comprar</button>
      <div id="datos_consulta" style="display:none">
        <input type="text" name="" id="Consulta_Descripcion" placeholder="aqui" value="Del Valle 100% Jugo sabor Naranja de 946 mililitros.">
        //<input type="text" name="" id="Consulta_Descripcion" placeholder="aqui" value="Del Valle 100% Jugo sabor Naranja de 946 mililitros.">
      </div>
      <!-- VISUALIZACION DE VENTANA CON DESCRIPCION -->
      <button id="Boton_descripcion" onclick="ventanaDescripcion()">Ver descripción</button>
    </div>

  </body>
</html>
